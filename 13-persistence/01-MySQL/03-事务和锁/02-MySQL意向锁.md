# 02-MySQL意向锁

[TOC]

## 02-MySQL意向锁定义

意向锁是由数据引擎自己维护的,用户无法手动操作意向锁

- 意向共享锁(Intention Shared Lock, 简称 IS 锁 )

  > 表示事务准备给数据行加入共享锁,也就是说一个数据行加共享锁前必须先取得该锁的 IS 锁

- 意向排他锁(Intention Exclusive Lock, 简称 IX 锁) 

  > 表示事务准备给数据行加入排他锁,说明事务在一个数据行排他锁前必须获取该锁的 意向锁 IX锁

也就是说，当我们给一行数据加上共享锁之前，数据库会自动在这张表上面加一个意向共享锁。当我们给一行数据加上排他锁之前，数据库会自动在这张表上面加一个意向排他锁。

反过来说: 

- 如果一张表上面至少有一个意向共享锁，说明有其他的事务给其中的某些数据行加上了共享锁。 

- 如果一张表上面至少有一个意向排他锁，说明有其他的事务给其中的某些数据行加上了排他锁。

```sql
select * from t2 where id =4 for update;
```

## 为什么需要意向锁

- 我们有了表级别的锁，在 InnoDB 里面就可以支持更多粒度的锁。
- 如果说没有意向锁的话，当我们准备给一张表加上表锁的时候，**必须先要去判断有没其他的事务锁定了其中了某些行**,如果有的话，肯定不能加上表锁。那么这个 时候我们就要去扫描整张表才能确定能不能成功加上一个表锁，如果数据量特别大，比 如有上千万的数据的时候，加表锁的效率是不是很低?

但是我们引入了意向锁之后就不一样了。我只要判断这张表上面有没有意向锁，如 果有，就直接返回失败。如果没有，就可以加锁成功。所以 InnoDB 里面的表锁，我们 可以把它理解成一个标志。就像火车上厕所有没有人使用的灯，

**意向锁是用来提高加锁的效率的。**

![image-20200826193846099](../../../assets/image-20200826193846099.png)